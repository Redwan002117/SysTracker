version: '3.8'

services:
  systracker-windows:
    build:
      context: .
      dockerfile: ./Docker/Dockerfile.windows
    container_name: systracker-windows
    
    ports:
      - "7777:7777"
    
    environment:
      PORT: 7777
      NODE_ENV: production
      API_KEY: ${API_KEY:-docker_change_me}
      JWT_SECRET: ${JWT_SECRET:-}
      JWT_EXPIRES_IN: ${JWT_EXPIRES_IN:-24h}
      SMTP_HOST: ${SMTP_HOST:-smtp.gmail.com}
      SMTP_PORT: ${SMTP_PORT:-587}
      SMTP_USER: ${SMTP_USER:-}
      SMTP_PASS: ${SMTP_PASS:-}
      SMTP_SECURE: ${SMTP_SECURE:-false}
      SMTP_FROM: ${SMTP_FROM:-"SysTracker" <noreply@systracker.local>}
    
    volumes:
      - ./server/data:/app/data
      - ./server/uploads:/app/uploads
      - ./server/logs:/app/logs
    
    restart: unless-stopped
    
    healthcheck:
      test: powershell -Command "try { $$response = Invoke-WebRequest -Uri 'http://localhost:7777/api/auth/status' -UseBasicParsing; if ($$response.StatusCode -eq 200) { exit 0 } else { exit 1 } } catch { exit 1 }"
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    
    labels:
      com.systracker.description: "SysTracker System Monitoring Server - Windows Container"
      com.systracker.version: "3.1.2"
      com.systracker.platform: "windows"
